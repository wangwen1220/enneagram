/*! mobilebone.js by zhangxinxu(.com) 2014-09-26 | https://github.com/zhangxinxu/mobilebone */
!function(a,b){"function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(c){return b(a,c)}):a.Mobilebone=b(a,{})}(this,function(a,b){var h,i,c={},d=[],e=d.slice,f=/^.[^:#\[\.,]*$/,g="pushState"in history&&"replaceState"in history;return b.support=g,0==g?b:(h=!1,b.VERSION="1.1.7",b.captureLink=!0,b.rootTransition=a,b.mergeCallback=!0,b.classPage="page",b.classMask="mask",b.pushStateEnabled=!0,window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window&&(b.pushStateEnabled=!1),b.transition=function(a,d,e,f){var h,j,k,l,m,n,o,p,q,r,s,t,u;0!=arguments.length&&a!=d&&(3==arguments.length&&1==isNaN(1*e)&&(f=e,e=!1),d=d||null,e=e||!1,f=f||{},h={root:this.rootTransition,form:this.form||"slide",onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,fallback:this.fallback,callback:this.callback},j=function(a){if(!a||!a.getAttribute)return{};var c={},d=i(a.getAttribute("data-params")||"");return["title","root","form"].forEach(function(b){c[b]=a.getAttribute("data-"+b)||d[b]||f[b]||h[b]}),"string"==typeof c.root&&(c.root=b.getFunction(c.root)),["onpagefirstinto","callback","fallback","animationstart","animationend"].forEach(function(e){if(1==b.mergeCallback&&"function"==typeof h[e]){var g=a.getAttribute("data-"+e)||d[e];c[e]="function"==typeof c.root[g]?function(){h[e].apply(null,arguments),c.root[g].apply(null,arguments)}:"function"==typeof f[e]?function(){h[e].apply(null,arguments),f[e].apply(null,arguments)}:h[e]}else c[e]=a.getAttribute("data-"+e)||d[e]||f[e]||h[e]}),c},k=j(d),l=j(a),null!=d&&d.classList&&(d.classList.add("out"),d.classList.add(k.form),d.classList.remove("in"),d.classList[e?"add":"remove"]("reverse"),m=k.fallback,"string"==typeof m&&(m=k.root[m]),"function"==typeof m&&m(a,d,f.response)),null!=a&&a.classList&&(n=l.title,o=document.querySelector("h1"),p=document.querySelector("."+this.classPage),n?(document.title=n,o&&(o.innerHTML=n,o.title=n)):p==a&&!d&&document.title&&a.setAttribute("data-title",document.title),q=f.id||a.id,f.remove!==!1&&c[q]&&c[q]!=a&&c[q].parentElement&&(c[q].parentElement.removeChild(c[q]),delete c[q]),a.style.display="block",a.clientWidth,a.classList.remove("out"),a.classList.add("in"),d&&a.classList.add(l.form),a.classList[e?"add":"remove"]("reverse"),r=l.onpagefirstinto,c[q]||("string"==typeof r&&l.root[r]?l.root[r](a,d,f.response):"function"==typeof r&&r(a,d,f.response)),s="WebkitAppearance"in document.documentElement.style||"undefined"!=typeof document.webkitHidden,["animationstart","animationend"].forEach(function(b,d){var g,e=l[b],f="webkit"+b.replace(/^a|s|e/g,function(a){return a.toUpperCase()});c[q]||(g=s?f:b,d&&a.addEventListener(g,function(){0==this.classList.contains("in")&&(this.style.display="none")}),"string"==typeof e&&l.root[e]?a.addEventListener(g,function(){l.root[e](this,this.classList.contains("in")?"into":"out")}):"function"==typeof e&&a.addEventListener(g,function(){e(this,this.classList.contains("in")?"into":"out")}))}),t=q,t&&0==/^#/.test(t)&&(t="#"+t),g&&this.pushStateEnabled&&f.history!==!1&&t&&history[d?"pushState":"replaceState"](null,document.title,t.replace(/^#/,"#&")),c[q]||(c[q]=a),u=l.callback,"string"==typeof u&&(u=l.root[u]),"function"==typeof u&&u(a,d,f.response)))},b.getCleanUrl=function(a,b,c){var g,d="",e="",f="";if(a&&(1==a.nodeType?(d=a.getAttribute("href"),e=a.getAttribute("data-formdata")||a.getAttribute("data-data")):a.url&&(d=a.url,e=a.data)),!(d=d||b))return"";if(e=e||c||"","object"==typeof e){g=[];for(key in c)g.push(key+"="+encodeURIComponent(c[key]));e=g.length>0?g.join("&"):""}return f=d.split("#")[0].replace(/&+$/,""),"?"==f.slice(-1)&&(f=f.split("?")[0]),""!=e&&(/\?/.test(f)?(e=e.replace(/^&|\?/,""),f=f+"&"+e):""!=e&&(e=e.replace("?",""),f=f+"?"+e)),f},b.createPage=function(a,b,c){var e,f,g,h,i,d=null;a&&(c=c||{},e=document.querySelector(".in."+this.classPage),b&&(1==b.nodeType?(b.href&&(f=b.getAttribute("data-title")||c.title),d=c.response):(d=b.response||c.response,f=b.title||c.title)),g=null,h=document.createElement("div"),"string"==typeof a?h.innerHTML=a:h.appendChild(a),i=h.getElementsByTagName("title")[0],(g=h.querySelector("."+this.classPage))?i?g.setAttribute("data-title",i.innerText):"string"==typeof f&&g.setAttribute("data-title",f):(h.className="page out","string"==typeof f&&h.setAttribute("data-title",f),g=h),document.body.appendChild(g),h=null,this.transition(g,e,{response:d||a,id:this.getCleanUrl(b)||g.id||"unique"+Date.now()}))},b.getFunction=function(b){var c,d,e;if("string"==typeof b){for(c=a,d=b.split("."),e=0;e<d.length&&(c=c[d[e]]);e+=1);return c}},b.ajax=function(a){var c,d,e,g,f,h;if(a){if(c={url:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},d={},e=null,f={},1==a.nodeType){f=i(a.getAttribute("data-params")||"");for(key in c)d[key]=a.getAttribute("data-"+key)||f[key]||c[key],"function"==typeof c[key]&&"string"==typeof d[key]&&(d[key]=this.getFunction(d[key]),"function"!=typeof d[key]&&(d[key]=c[key]));d.url=this.getCleanUrl(a,d.url),g=a.getAttribute("data-mask"),("true"==g||""==g)&&(e=a.querySelector("."+this.classMask))}else{if(!a.url)return;for(key2 in c)d[key2]=a[key2]||c[key2];d.url=this.getCleanUrl(null,d.url,d.data),d.title=a.title}"string"!=typeof g&&(e=document.querySelector("body > ."+this.classMask)),null==e&&(e=document.createElement("div"),e.className=this.classMask,e.innerHTML='<i class="loading"></i>',"string"==typeof g?a.appendChild(e):document.body.appendChild(e)),e.style.visibility="visible",h=new XMLHttpRequest,h.open("GET",d.url+(/\?/.test(d.url)?"&":"?")+"r="+Date.now(),d.async,d.username,d.password),h.timeout=d.timeout,h.onload=function(){var c=null;if(200==h.status){if("json"==d.dataType||"JSON"==d.dataType)try{c=JSON.parse(h.response),d.response=c,b.createPage(b.jsonHandle(c),a,d)}catch(f){d.message="JSON parse errorï¼š"+f.message,d.error.call(d,h,h.status)}else if("unknown"==d.dataType)try{c=JSON.parse(h.response),d.response=c,b.createPage(b.jsonHandle(c),a,d)}catch(f){c=h.response,b.createPage(c,a,d)}else c=h.response,b.createPage(c,a,d);d.success.call(d,c,h.status)}else d.message="The status code exception!",d.error.call(d,h,h.status);d.complete.call(d,h,h.status),e.style.visibility="hidden"},h.onerror=function(){d.message="Illegal request address or an unexpected network error!",d.error.call(d,h,h.status),e.style.visibility="hidden"},h.ontimeout=function(){d.message="The request timeout!",d.error.call(d,h,h.status),e.style.visibility="hidden"},h.send(null)}},b.isBack=function(a,c){var d=-1,f=-1;return 1==history.tempBack?f=0:e.call(document.querySelectorAll("."+b.classPage)).forEach(function(b,e){b==a?d=e:b==c&&(f=e)}),history.tempBack=null,f>d},b.jsonHandle=function(){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},b.init=function(){var c,d,e,g;return 1==h?"Don't repeat initialization!":(c=location.hash.replace("#&","#"),d=null,""==c||"#"==c?this.transition(document.querySelector("."+this.classPage)):1==f.test(c)&&(d=document.querySelector(c))&&d.classList.contains(this.classPage)?this.transition(d):this.ajax({url:c.replace("#",""),dataType:"unknown",error:function(){d=document.querySelector("."+b.classPage),b.transition(d)}}),e="click",g=a.$||a.jQuery||a.Zepto,g&&g.fn&&g.fn.tap&&(e="tap"),1==this.captureLink&&(document.addEventListener(e,this.handleTapEvent),"tap"==e&&document.addEventListener("click",function(a){var d,e,c=a.target;c&&("a"==c.tagName.toLowerCase()||(c=c.getParentElementByTag("a")))&&(d=c.getAttribute("data-ajax"),e=c.href,"external"==c.getAttribute("data-rel")||"false"==d||e.split("/")[0]!==location.href.split("/")[0]&&"true"!=d||0==b.captureLink&&"true"!=d||a.preventDefault())})),h=!0,void 0)},b.handleTapEvent=function(a){var f,g,h,i,j,k,l,m,n,o,p,d=a.target||a.touches[0],e=d.href;if(e&&0!=/a/i.test(d.tagName)||!(d=d.getParentElementByTag("a"))||(e=d.href),f=document.querySelector(".in."+b.classPage),null!=f&&d){if(g=d.getElementsByClassName(b.classMask)[0],g&&"hidden"!=g.style.visibility)return a.preventDefault(),!1;if(h=1==b.captureLink,i=d.getAttribute("data-rel"),j=!1,"back"==i&&(j=!0),k="external"==i,e){if(""===d.getAttribute("href").replace(/#/g,""))return a.preventDefault(),void 0;if(/^javascript/.test(e)){if(0==j)return}else if(k=k||e.split("/")[0]!==location.href.split("/")[0],(1==k||0==h)&&"true"!=d.getAttribute("data-ajax"))return;1==/^#/.test(d.getAttribute("href"))?(l=e.split("#")[1],m=l&&document.getElementById(l),0==j&&"auto"==i&&(j=b.isBack(m,f)),m&&b.transition(m,f,j),a.preventDefault()):/^javascript/.test(e)?(history.tempBack=!0,history.back()):"false"!=d.getAttribute("data-ajax")&&(n=b.getCleanUrl(d),o=d.getAttribute("data-reload"),p=d.getAttribute("href"),null!=o&&"false"!=o||!c[n]?b.ajax(d):(0==j&&"auto"==i&&(j=b.isBack(c[p],f)),b.transition(c[p],f,j,{id:p})),a.preventDefault())}}},Element.prototype.getParentElementByTag=function(a){var b,c,d;return a?(b=null,c=this,d=function(){c=c.parentElement;var e=c.tagName.toLowerCase();e===a?b=c:"body"==e?b=null:d()},d(),b):null},i=function(a){var b={};return"string"==typeof a&&a.split("&").forEach(function(a){var c=a.split("=");c.length>1&&(b[c[0]]=a.replace(c[0]+"=",""))}),b},window.addEventListener("DOMContentLoaded",function(){0==h&&b.init()}),window.addEventListener("popstate",function(){var e,a=location.hash.replace("#&","").replace("#",""),d=c[a];if(!d){if(0==f.test(a))return;d=document.querySelector("#"+a)}e=document.querySelector(".in."+b.classPage),d&&d==e||0==b.pushStateEnabled||d&&b.transition(d,e,b.isBack(d,e),{history:!1,remove:!1})}),b)});